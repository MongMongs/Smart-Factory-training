## -  아두이노 코드

```
#include <WiFi.h>
#include <PubSubClient.h>

const char* ssid = "pcroom";
const char* password = "12345678";
const char* userId = "mqtt_juj";
const char* userPw = "1234";
const char* clientId = userId;
const char *topic = "MyOffice/Indoor/led";
const char* serverIPAddress = "192.168.0.48";
char messageBuf[100];

#define LED_PIN 0  // D5 대신 GPIO 14 사용

void callback(char* topic, byte* payload, unsigned int length) {
  Serial.println("Message arrived!\nTopic: " + String(topic));
  Serial.println("Length: "+ String(length, DEC));

  strncpy(messageBuf, (char*)payload, length);
  messageBuf[length] = '\0';

  String ledState = String(messageBuf);
  Serial.println("Payload: " + ledState + "\n\n");

  if(ledState == "1"){
    digitalWrite(LED_PIN, LOW);
  }
  else if(ledState == "0"){
    digitalWrite(LED_PIN, HIGH);
  }
  else{
    Serial.println("Wrong Message");
  }
}

WiFiClient wifiClient;
PubSubClient client(serverIPAddress, 1883, callback, wifiClient);

void setup() {
  pinMode(LED_PIN, OUTPUT);
  digitalWrite(LED_PIN, HIGH);

  Serial.begin(9600);

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    Serial.print("."); 
    delay(1000);
  }
  Serial.println("\nWiFi Connected\nConnecting to broker");

  while (!client.connect(clientId, userId, userPw)) { 
    Serial.print("*"); 
    delay(1000);
  }
  Serial.println("\nConnected to broker");

  Serial.println(String("Subscribing! topic= ") + topic);
  client.subscribe(topic);
}

void loop() {
  client.loop();
}
```
- 위 코드에 0(ON) , 1(OFF)가 ledState에 입력되면 LED가 ON/OFF 한다.
![image](https://github.com/user-attachments/assets/866241a6-68fc-44d7-bdff-a6479fee9294)


## - 웹앱으로 ESP32에 연결된 led ON/OFF 제어

```
```

## - 윈폼으로 ESP32에 연결된 led ON/OFF 제어

```
using System;
using System.Windows.Forms;
using Renci.SshNet;

namespace WinFormsApp40
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void ON_Click(object sender, EventArgs e)
        {
            string host = "192.168.0.48";  // 라즈베리 파이 IP
            string username = "juj";     // 사용자 이름
            string password = "12345678";      // 비밀번호

            using var client = new SshClient(host, username, password);
            client.Connect();  // SSH 연결
            if (client.IsConnected)
            {
                var command = client.RunCommand("mosquitto_pub -t MyOffice/Indoor/led -m 0 -u juj -P 1234");
            } // SSH 연결 해제

        }

        private void OFF_Click(object sender, EventArgs e)
        {
            string host = "192.168.0.48";  // 라즈베리 파이 IP
            string username = "juj";     // 사용자 이름
            string password = "12345678";      // 비밀번호

            using (var client = new SshClient(host, username, password))
            {
                client.Connect();  // SSH 연결
                if (client.IsConnected)
                {
                    var command = client.RunCommand("mosquitto_pub -t MyOffice/Indoor/led -m 1 -u juj -P 1234");
                }
            }

        }
    }
}
```

- 
![image](https://github.com/user-attachments/assets/526c9d75-17a8-4adc-91d6-613e271501d8)


## - 라즈배리 파이로 ESP32에 연결된 led ON/OFF 제어

- ON
```
import time
import paho.mqtt.client as mqtt

mqtt_broker = "192.168.0.48"  
mqtt_port = 1883
mqtt_topic = "MyOffice/Indoor/led"

def on_connect(client, userdata, flags, rc):
    if rc == 0:
        print("Connected to MQTT broker")
        client.publish(mqtt_topic, "0")
        print("Sent '0' to the topic to turn on LED")
    else:
        print(f"Failed to connect, return code {rc}")

client = mqtt.Client()
client.username_pw_set(username="mqtt_imyme", password="1234") 
client.on_connect = on_connect
client.connect(mqtt_broker, mqtt_port, 60)

client.loop_start()

time.sleep(2)

client.loop_stop()
client.disconnect()
print("Program finished")
```
- OFF
```
import time
import paho.mqtt.client as mqtt

mqtt_broker = "192.168.0.48"  
mqtt_port = 1883
mqtt_topic = "MyOffice/Indoor/led"

def on_connect(client, userdata, flags, rc):
    if rc == 0:
        print("Connected to MQTT broker")
        client.publish(mqtt_topic, "1")
        print("Sent '1' to the topic to turn off LED")
    else:
        print(f"Failed to connect, return code {rc}")

client = mqtt.Client()
client.username_pw_set(username="mqtt_imyme", password="1234") 
client.on_connect = on_connect
client.connect(mqtt_broker, mqtt_port, 60)

client.loop_start()

time.sleep(2)

client.loop_stop()
client.disconnect()
print("Program finished")
```
![image](https://github.com/user-attachments/assets/f055db4d-9c6d-4bfd-8b58-c9e6fbf54ba1)
