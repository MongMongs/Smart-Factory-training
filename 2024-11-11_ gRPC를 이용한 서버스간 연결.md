# 1. 가상 환경 설정

가상 환경 설치를 위해서 터미널 창을 연다. IDE에서 터미널 창을 열어서 명령을 수행 할 수 있으므로 그렇게 진행하였다. cursor IDE에서 (ctrl + shift + `)를 누르면 새로운 터미널이 IDE 하단에 나타난다.


```
# 가상 환경 생성
python -m venv venv

# 가상 환경 활성화
.\venv\Scripts\Activate
```

## 1-1. 발생한 문제 : 버전 불일치


1) Windows: C:\Users\YourUsername\.vscode\extensions의 ms-python.vscode-pylance-*와 ms-python.python-* 폴더를 삭제


- 폴더 위치 :

![image](https://github.com/user-attachments/assets/a5260e88-f17d-4102-928d-b8acb599b90a) 

- 다음 과 같은 오류 발생


```
>> # 가상 환경 생성tivate
>> python -m venv venv~~~
>>  + CategoryInfo          : 보안 오류: (:) [], PSSecurityException
>> # 가상 환경 활성화rrorId : UnauthorizedAccess  
>> .\venv\Scripts\Activateorkspace\ws>

```

- 해결 방법: PowerShell 실행 정책 변경


1) 관리자 권한으로 PowerShell 실행

시작 메뉴에서 PowerShell을 마우스 오른쪽 클릭한 후 관리자 권한으로 실행을 선택하세요.

2) 실행 정책 변경

관리자 권한 PowerShell에서 다음 명령을 입력하여 실행 정책을 변경합니다:


powershell

```
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```


위 명령어는 현재 사용자에 대해 로컬 스크립트의 실행을 허용하고, 원격에서 다운로드한 스크립트는 서명이 필요하도록 설정합니다.


3) 확인 및 실행

변경 사항을 적용하려면 Y를 입력하고 Enter를 누릅니다.
이제 다시 Visual Studio Code로 돌아가서 가상 환경을 활성화할 수 있습니다.


4) 가상 환경 활성화
위 단계를 완료한 후, PowerShell 터미널에서 다음 명령으로 가상 환경을 활성화해 보세요.


\```powershell
.\venv\Scripts\Activate
\```
이제 가상 환경이 정상적으로 활성화될 것입니다.

# 2. gRPC 패키지 설치
gRPC 사용을 위해 grpcio와 grpcio-tools라는 파이썬 패키지를 설치한다.

```powershell
pip install grpcio grpcio-tools
```

# 3. hello.proto 파일 작성


```python
syntax = "proto3";

package hello;

// 서비스 정의
service Greeter {
    rpc SayHello (HelloRequest) returns (HelloReply) {}
    rpc ReqRemoteCommand (RcmdRequest) returns (RcmdReply) {}
}

// 요청 메시지
message HelloRequest {
    string name = 1;
}

// 응답 메시지
message HelloReply {
    string message = 1;
}

message RcmdRequest {
    string command = 1;
    string param = 2;
}

message RcmdReply {
    string ack = 1;
}
```


나는 C:\Users\Admin\source\workspace\ws\Hello_pk 에 hello.proto 파일을 넣고 아래 코드를 터미널에 입력했다.


```powershell
python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. hello.proto
```


- 결과


hello_pb2.py ,  hello_pb2_grpc.py 파일이 더 추가됐다.


![image](https://github.com/user-attachments/assets/83f38966-c03c-4bc1-84f3-1976386ca259)


# 5. gRPC 서버 프로그램 작성


포트는 50051로 하였고 client로 부터 요청이 오면 어떤 client로 부터 요청을 받았는지 print하도록 되어 있다. 각 RPC(Remote Procesure Call) 호출 시 action 수행 후 회신을 하도록 하였다.

- hello_server.py

```python
import grpc
from concurrent import futures
import time
import hello_pb2
import hello_pb2_grpc

class GreeterServicer(hello_pb2_grpc.GreeterServicer):
    def SayHello(self, request, context):
        print(f"received SayHello from {request.name}")
        message = f"Hello, {request.name}!"
        return hello_pb2.HelloReply(message=message)
    def ReqRemoteCommand(self, request, context):
        print(f"received RCMD, RCMD= {request.command}, PARAM= {request.param}!")
        # TODO: 명령을 처리하는 부분 구현
        return hello_pb2.RcmdReply(ack="OK")

def serve():
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))
    hello_pb2_grpc.add_GreeterServicer_to_server(GreeterServicer(), server)
    server.add_insecure_port('[::]:50051')
    server.start()
    print("Server started on port 50051")
    
    try:
        while True:
            time.sleep(86400)
    except KeyboardInterrupt:
        server.stop(0)

if __name__ == '__main__':
    serve()
```


# 6. 서버 실행


아래 코드로 가상 환경이 활성화된 상태에서 서버를 실행 합니다.


```
python hello_server.py
```


- 실행 결과

: 오류가 나지 않은 이유는 이전에 python을 설치해서 그런 것으로 보인다.(실행 후기 ppt : https://docs.google.com/presentation/d/1dzdpFXHBYWPyOWHJ_2_p5Bk1lAhJYSHrLIensI8lqg0/edit?usp=sharing )

![image](https://github.com/user-attachments/assets/a23232d0-ee4a-464e-8d1d-650610adcedc)
