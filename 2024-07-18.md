## 오라클 함수

## ORACLE SWITCH CASE 문 DECODE
--2024-07-18

--6-7장

-- DECODE 디코드가 더 좋음 실제로는 디코드 사용함

SELECT EMPNO, ENAME, JOB, SAL, 
DECODE(JOB,
'MANAGER',SAL*1.1,
'SALESMAN',SAL*1.05,
'AMALYST',SAL,
SAL*1.03)AS UPSAL 
FROM EMP;


--CASE

SELECT EMPNO,ENAME,JOB, SAL,
    CASE JOB
        WHEN 'MANAGER' THEN SAL*1.1
        WHEN 'SALESMAN' THEN SAL*1.05
        WHEN 'AMALYST' THEN SAL
        ELSE SAL*1.03
    END AS UPSAL 
FROM EMP;


--175P 연습문제4

-- DECODE 사용 VER

SELECT EMPNO, ENAME, MGR, 
    DECODE(SUBSTR(TO_CHAR(MGR),1,2),
        '75','5555',
        '76','6666',
        '77','7777',
        '78','8888',
        (null),'0000',
    TO_CHAR(MGR))AS CHG_MGR 
FROM EMP;


-- CASE WHEN 사용 VER

SELECT EMPNO, ENAME, MGR,
    CASE
        WHEN MGR IS NULL THEN TO_CHAR('0000')
        WHEN SUBSTR(MGR, 1, 2) = 75 THEN TO_CHAR('5555')
        WHEN SUBSTR(MGR, 1, 2) = 76 THEN TO_CHAR('6666')
        ELSE TO_CHAR(MGR)
    END
FROM EMP;


-- 7장 다중행 함수 데이터 그룹화

SELECT SUM(SAL) FROM EMP;

SELECT MAX(SAL) FROM EMP;

SELECT MIN(SAL) FROM EMP;

SELECT AVG(SAL) FROM EMP;

SELECT ROUND(AVG(SAL), 2) FROM EMP;


-- 집합 연산 다중행 연산 묶어서 처리하기

SELECT ROUND(AVG(SAL), 2) FROM EMP
WHERE DEPTNO = 20;

SELECT ENAME, SAL, DEPTNO FROM EMP;

SELECT ROUND(AVG(SAL), 2) FROM EMP

GROUP BY DEPTNO;


-- GROUP BY 가 있어야 DEPTNO 행 넣을 수 있음

SELECT DEPTNO, ROUND(AVG(SAL), 2)FROM EMP

GROUP BY DEPTNO ORDER BY DEPTNO;


-- 부서 급여의 합

SELECT DEPTNO, SUM(SAL)FROM EMP

GROUP BY DEPTNO ORDER BY DEPTNO;

--급여의 합 구하기179P

-- ALL 생략 가능

SELECT SUM(DISTINCT SAL),
    SUM (ALL SAL),
    SUM(SAL)
FROM EMP;


-- 직원 수 구하기

SELECT COUNT(*) FROM EMP;


-- 부서 별 직원수 구하기

SELECT DEPTNO, COUNT(*) FROM EMP GROUP BY DEPTNO ORDER BY DEPTNO;


-- 부서번호가 10번인 사원의 최대급여

SELECT MAX(SAL) FROM EMP WHERE DEPTNO = 10;


-- 최근 날짜

-- 부서번호가 20번인 직원 중 가장 최근에 입사한 사람의 입사일

SELECT MAX(HIREDATE)FROM EMP WHERE DEPTNO = 20;


-- 부서번호가 20번인 직원 중 가장 오랫동안 일한 사람의 입사일

SELECT MIN(HIREDATE)FROM EMP WHERE DEPTNO = 20;


-- HAVING 절 GROUP BY 의 조건

SELECT DEPTNO, JOB, ROUND(AVG(SAL),2) FROM EMP GROUP BY DEPTNO, JOB;


-- 평균 급여가 2000 이상인 직원

SELECT DEPTNO, JOB, ROUND(AVG(SAL),2) FROM EMP GROUP BY DEPTNO, JOB HAVING ROUND(AVG(SAL),2)>=2000 ORDER BY DEPTNO, JOB;


-- WHERE 절 HAVING 절 같이 사용(WHERE이 HAVING보다 먼저 나와야함!집합함수 단독사용 불가GROUP BY 사용해야 가능)

-- WHERE> GROUP> HAVING> ORDER순으로 나와야함 순서 안맞추면 오류생김

SELECT DEPTNO, JOB, AVG(SAL) FROM EMP WHERE SAL <=3000 GROUP BY DEPTNO, JOB HAVING AVG(SAL) >= 2000 ORDER BY DEPTNO, JOB;


-- 212P

-- Q1

SELECT DEPTNO, ROUND(AVG(SAL),0) AS AVG_SAL, MAX(SAL)AS MAX_SAL, MIN(SAL) AS MIN_SAL, COUNT(*) FROM EMP GROUP BY DEPTNO ORDER BY DEPTNO;


-- Q2

SELECT JOB, COUNT(*)FROM EMP GROUP BY JOB HAVING COUNT(*) >= 3; 


-- Q3

SELECT TO_CHAR(HIREDATE,'YYYY'), DEPTNO, COUNT(*) FROM EMP GROUP BY TO_CHAR(HIREDATE,'YYYY'), DEPTNO ORDER BY TO_CHAR(HIREDATE,'YYYY');

SELECT * FROM MOVIES; 



-- Q1 

SELECT GENRE, COUNT(GENRE)FROM MOVIES GROUP BY GENRE;


--Q2

SELECT * FROM MOVIES WHERE RUNTIME >= 130;


-- Q3 SUM(COUNT(TO_NUMBER(TO_CHAR(RELEASE_DATE,'YY'))))

SELECT 
    SUM (CASE 
        WHEN TO_NUMBER(TO_CHAR(RELEASE_DATE,'YY'))>14 THEN 1 ELSE 0
    END) AS "2014 이후",
    SUM (CASE 
        WHEN TO_NUMBER(TO_CHAR(RELEASE_DATE,'YY'))<=14 THEN 1
        ELSE 0
    END)"2014 이전"
FROM MOVIES;


-- Q4

SELECT AVG(RUNTIME) FROM MOVIES;


-- Q5 SUB QUARY를 이용해야함 앞으로 배울 내용

SELECT TITLE, RUNTIME FROM MOVIES WHERE RUNTIME = (SELECT MIN(RUNTIME) FROM MOVIES) OR RUNTIME = (SELECT MAX(RUNTIME) FROM MOVIES);


-- 7-24

SELECT DEPTNO, JOB, COUNT(*), MAX(SAL),MIN(SAL),SUM(SAL), AVG(SAL) FROM EMP GROUP BY DEPTNO,JOB ORDER BY DEPTNO, JOB;


-- ROLL UP 그룹 화 결과를 출력

SELECT DEPTNO, JOB, COUNT(*), MAX(SAL),MIN(SAL),SUM(SAL), AVG(SAL) FROM EMP GROUP BY ROLLUP (DEPTNO,JOB);


-- CUBE

SELECT DEPTNO, JOB, COUNT(*), MAX(SAL),MIN(SAL),SUM(SAL), ROUND(AVG(SAL),2) FROM EMP GROUP BY CUBE (DEPTNO,JOB) ORDER BY DEPTNO, JOB;


-- 7-36 PIVOT

SELECT DEPTNO, JOB, MAX(SAL) FROM EMP GROUP BY DEPTNO, JOB ORDER BY DEPTNO, JOB;

SELECT * FROM (SELECT DEPTNO, JOB, SAL FROM EMP)
    PIVOT(MAX(SAL) 
    FOR DEPTNO IN (10,20,30)
    )
ORDER BY JOB;


-- 실습 7-37 부서별, 직책 별 최고급여를 2차원 표 형태로 출력

SELECT * FROM (SELECT JOB, DEPTNO, SAL FROM EMP)
    PIVOT(MAX(SAL)
        FOR JOB IN (
        'CLERK',
        'SALESMAN',
        'PRESIDENT',
        'MANAGER',
        'ANALYST'))
ORDER BY DEPTNO;

SELECT * FROM EMP ORDER BY DEPTNO;


-- 8장

-- JOIN 테이블의 결합

SELECT * FROM EMP;

SELECT COUNT(*) FROM EMP; -- 12

SELECT * FROM DEPT;

SELECT COUNT(*) FROM DEPT;


-- EMP, DEPT 합침

SELECT * FROM EMP , DEPT;

SELECT COUNT(*) FROM EMP, DEPT;

SELECT * FROM EMP , DEPT WHERE EMP.DEPTNO = DEPT.DEPTNO;


-- 테이블 별칭 (실습 8-3) 키워드만 넣어 테이블 만듦, 두테이블의 데이터 종류 중 하나 같은것이 있어야한다 여기선 (DEPTNO)

SELECT * FROM EMP E, DEPT D

WHERE E.DEPTNO = D.DEPTNO

ORDER BY EMPNO;


SELECT * FROM EMP;

SELECT * FROM DEPT;


SELECT E.EMPNO, E.ENAME, D.DNAME, D.LOC FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO;


-- 실습 8-6

-- WHERE에 추가로 조건식을 넣어 출력

SELECT * FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO;

SELECT E.EMPNO, E.ENAME, D.DNAME, D.LOC FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO;


-- 급여가 2500 이하 사원번호가 9999 이하인 사원의 정보 출력 코드(223P)

SELECT * FROM EMP E, DEPT D WHERE E.DEPTNO = D.DEPTNO AND EMPNO <=7600 AND SAL <=2500;


--예제 3 중복되는 영화배우 출력

SELECT * FROM MOVIES;

SELECT * FROM ACTORS;

SELECT * FROM MOVIE_ACTORS;

SELECT M.TITLE, A.NAME FROM MOVIES M, ACTORS A, MOVIE_ACTORS MA

WHERE M.MOVIE_ID = MA.MOVIE_ID

AND A.ACTOR_ID = MA.ACTOR_ID;

